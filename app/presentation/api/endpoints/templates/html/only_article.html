
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ article.title }}</title>
    <link rel="stylesheet" href="/static/css/only_article.css">
    <script src="/static/js/menu.js" defer></script>
</head>
<body>
    <button class="menu-icon">
        <i class="fa-solid fa-align-justify"></i>
    </button>
    <div class='menu-items'> 
        {% if not auth %}
            <a href="/auth" class="item-menu">
                Войти
            </a>
        {% endif %}  
        <a href="/" class="item-menu">
            Домой
        </a> 
        <a href="/article/submit" class="item-menu">
            Добавить статью
        </a>
        <a href="/user/profile/{{ auth.unique_username }}" class="item-menu">
            Профиль
        </a>
        {% if auth %}
        <a href="/exit"  class="item-menu">
            Выход
        </a>
        {% endif %}
    </div>
    
    <div class="container">
        <div class="article-card">
            <div class="article-header">
                <h1 class="article-title">{{ article.title }}</h1>
                <div class="article-meta">
                    <div class="meta-item">
                        <span class="meta-label">Автор:</span>
                        <span class="meta-author">{{ article.nickname }} <a href='/user/profile/{{article.unique_username}}'>{{ article.unique_username }}</a></span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Дата публикации: </span>
                        <span class="meta-date">{{ article.created_at.strftime('%d.%m.%Y %H:%M') }}</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Категории: </span>
                        <span class="meta-category">{{ article.category }}</span>
                    </div>
                </div>
            </div>
        
            <div class="article-content">
                <p>{{ article.content }}</p>
        
            </div>
        </div>
        <div class="like-text">
            Понравилась статья? Поставь лайк, поддержи автора! 
        </div>
        <div class="like-dislike">
            <form action="/article/like/{{article.article_id}}" method="POST">
                <button type="submit" class="like-btn">
                    {{article.likes}}
                </button>
            </form>
            <form action="/article/dislike/{{article.article_id}}" method="POST">
                <button type="submit" class="dislike-btn">
                    {{article.dislikes}}
                </button>
            </form>
        </div>

        <h2>Комментарии</h2>
        <div class="comment-section">
            {% if auth %}
            <form class="comment-form" method="POST" action="/comments/{{ article.article_id }}/create">
                <textarea 
                    name="content" 
                    id="comment-field"
                    required
                    maxlength="1000"
                ></textarea>
                <button id="submit-comment" type="submit">Отправить</button>
            </form>
            {% else %}
            <div class="login-message">
                <a href="/login">Войдите</a>, чтобы оставить комментарий
            </div>
            {% endif %}
            
            <!-- Список комментариев -->
            {% if comments %}
                {% for comment in comments %}
                <div class="comment">
                    <div class="comment-header">
                        <span class="comment-author">{{ comment.nickname }}</span>
                        <a href="/user/profile/{{ comment.unique_username }}" class="comment-author">{{ comment.unique_username }}</a>
                        <span class="comment-date">
                            {{ comment.created_at.strftime('%d.%m.%Y %H:%M') }}
                        </span>
                    </div>
                    <div class="comment-content">
                        {{ comment.content }}
                    </div>
                    {% if auth and auth.user_id == comment.author_id %}
                    <div class="comment-actions">
                        <form method="POST" action="/comments/{{ comment.id }}/delete" style="display: inline;">
                            <button type="submit" class="delete-btn" onclick="return confirm('Удалить комментарий?')">
                                Удалить
                            </button>
                        </form>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="no-comments">
                    Пока нет комментариев. Будьте первым!
                </div>
            {% endif %}
        </div>
    </div>
</body>
</html>